<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Numbers Practice</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      overflow: hidden;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      width: 90%;
      max-width: 700px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .title {
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .stat-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 1px; }
    .stat-value { font-size: 24px; font-weight: bold; color: #333; }
    
    /* Timer & Pulse Animation */
    .timer { font-size: 28px; font-weight: bold; color: #667eea; }
    .timer.warning { color: #ef4444; animation: pulse 1s ease-in-out infinite; }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    
    .control-group { display: flex; flex-direction: column; }
    .control-label { font-size: 13px; color: #666; margin-bottom: 5px; font-weight: 600; }
    .control-group input, .control-group select {
      padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; outline: none;
    }

    .keyboard-shortcuts {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
      color: #666;
      font-size: 14px;
    }
    
    .key {
      background: white; border: 2px solid #e0e0e0; border-radius: 6px;
      padding: 2px 8px; font-weight: bold; color: #667eea;
    }
    
    .phone-input {
      width: 100%;
      padding: 20px;
      border: 3px solid #e0e0e0;
      border-radius: 10px;
      font-size: 32px;
      text-align: center;
      outline: none;
      transition: all 0.2s;
      letter-spacing: 4px;
    }
    
    .phone-input.correct { border-color: #10b981; background: #f0fdf4; }
    .phone-input.incorrect { border-color: #ef4444; background: #fef2f2; }
    
    .hidden { display: none; }
    
    /* Result Screen Styling */
    .session-end { text-align: center; padding: 20px 0; }
    .result-title { font-size: 48px; font-weight: bold; margin-bottom: 30px; color: #333; }
    .result-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .result-stat { background: #f3f4f6; padding: 25px; border-radius: 15px; }
    .result-stat-value { font-size: 36px; font-weight: bold; color: #667eea; }
    .result-stat-label { font-size: 14px; color: #666; margin-top: 5px; text-transform: uppercase; font-weight: 600; }

    .btn { 
      padding: 15px 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; 
      font-size: 18px; transition: transform 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }
  </style>
</head>
<body>
  <div class="container">
    <div id="practiceScreen">
      <div class="header">
        <div class="title">Numbers Practice</div>
        <div style="display:flex; gap:20px;">
          <div style="text-align:center;">
            <div class="stat-label">Time</div>
            <div class="stat-value timer" id="timer">5:00</div>
          </div>
          <div style="text-align:center;">
            <div class="stat-label">Accuracy</div>
            <div class="stat-value" id="accuracy">0%</div>
          </div>
        </div>
      </div>
      
      <div class="controls">
        <div class="control-group">
          <label class="control-label">Length</label>
          <input type="number" id="lengthInput" value="10" min="3" max="15">
        </div>
        <div class="control-group">
          <label class="control-label">Speed</label>
          <select id="speedSelect">
            <option value="0.65">Slow</option>
            <option value="0.75" selected>Medium</option>
            <option value="0.85">Fast</option>
          </select>
        </div>
        <div class="control-group">
          <label class="control-label">Minutes</label>
          <input type="number" id="timeInput" value="5" min="1" max="60">
        </div>
      </div>
      
      <div class="keyboard-shortcuts">
        <div><span class="key">Space</span> New</div>
        <div><span class="key">Enter</span> Check</div>
        <div><span class="key">Alt</span> Repeat & Clear</div>
      </div>
      
      <input type="text" id="phoneInput" class="phone-input" placeholder="Type here..." autocomplete="off">
    </div>
    
    <div id="sessionEndScreen" class="session-end hidden">
      <div class="result-title">Time's Up! ðŸŽ‰</div>
      <div class="result-stats">
        <div class="result-stat">
          <div class="result-stat-value" id="finalAccuracy">0%</div>
          <div class="result-stat-label">Accuracy</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-value" id="finalCorrect">0</div>
          <div class="result-stat-label">Correct</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-value" id="finalMistakes">0</div>
          <div class="result-stat-label">Incorrect</div>
        </div>
      </div>
      <button class="btn" onclick="location.reload()">Play Again</button>
    </div>
  </div>

  <audio id="correctSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_success_fanfare.ogg"></audio>
  <audio id="incorrectSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>

  <script>
    const digitMap = { '0': 'oh', '1': 'one', '2': 'two', '3': 'three', '4': 'four', '5': 'five', '6': 'six', '7': 'seven', '8': 'eight', '9': 'nine' };
    let stats = { attempts: 0, correct: 0, mistakes: 0 };
    let timerStarted = false, remainingTime = 300, currentNumber = '', spokenParts = [];
    let isCurrentNumberSolved = false;

    const elements = {
      timer: document.getElementById('timer'),
      accuracy: document.getElementById('accuracy'),
      phoneInput: document.getElementById('phoneInput'),
      lengthInput: document.getElementById('lengthInput'),
      speedSelect: document.getElementById('speedSelect'),
      timeInput: document.getElementById('timeInput'),
      correctSound: document.getElementById('correctSound'),
      incorrectSound: document.getElementById('incorrectSound')
    };

    function updateTimerDisplay() {
      const m = Math.floor(remainingTime / 60);
      const s = remainingTime % 60;
      elements.timer.textContent = `${m}:${s.toString().padStart(2, '0')}`;
      if (remainingTime <= 30 && timerStarted) elements.timer.classList.add('warning');
    }

    // Initialize timer based on input
    elements.timeInput.addEventListener('input', () => {
      remainingTime = (parseInt(elements.timeInput.value) || 5) * 60;
      updateTimerDisplay();
    });

    function toSpokenString(numStr) {
      let spoken = [], i = 0;
      while (i < numStr.length) {
        const digit = numStr[i];
        let run = 1;
        while (i + run < numStr.length && numStr[i + run] === digit) { run++; }
        const word = digitMap[digit];
        if (run === 1) spoken.push(word);
        else if (run === 2) spoken.push('double ' + word);
        else if (run === 3) spoken.push('triple ' + word);
        else { for (let j = 0; j < run; j++) spoken.push(word); }
        i += run;
      }
      return spoken.join(' ');
    }

    async function speak(text) {
      speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-GB";
      utterance.rate = parseFloat(elements.speedSelect.value);
      speechSynthesis.speak(utterance);
      return new Promise(resolve => utterance.onend = resolve);
    }

    async function playNumber() {
      await speak(spokenParts[0]);
      await new Promise(r => setTimeout(r, 400));
      await speak(spokenParts[1]);
    }

    async function generate() {
      if (!timerStarted) {
        timerStarted = true;
        // Lock time input once game starts
        elements.timeInput.disabled = true;
        const interval = setInterval(() => {
          if (remainingTime > 0) {
            remainingTime--;
            updateTimerDisplay();
          } else {
            clearInterval(interval);
            showResults();
          }
        }, 1000);
      }
      isCurrentNumberSolved = false;
      currentNumber = '';
      const len = parseInt(elements.lengthInput.value) || 10;
      for (let i = 0; i < len; i++) currentNumber += Math.floor(Math.random() * 10);
      const half = Math.floor(currentNumber.length / 2);
      spokenParts = [toSpokenString(currentNumber.slice(0, half)), toSpokenString(currentNumber.slice(half))];
      elements.phoneInput.value = '';
      elements.phoneInput.className = 'phone-input';
      await playNumber();
      elements.phoneInput.focus();
    }

    function showResults() {
      document.getElementById('practiceScreen').classList.add('hidden');
      document.getElementById('sessionEndScreen').classList.remove('hidden');
      const finalAcc = stats.attempts > 0 ? Math.round((stats.correct / stats.attempts) * 100) : 0;
      document.getElementById('finalAccuracy').textContent = finalAcc + '%';
      document.getElementById('finalCorrect').textContent = stats.correct;
      document.getElementById('finalMistakes').textContent = stats.mistakes;
    }

    function checkAnswer() {
      if (!currentNumber || isCurrentNumberSolved) return;
      const val = elements.phoneInput.value.replace(/\D/g, '');
      if (!val) return;

      stats.attempts++;
      if (val === currentNumber) {
        stats.correct++;
        isCurrentNumberSolved = true;
        elements.phoneInput.className = 'phone-input correct';
        elements.correctSound.play();
      } else {
        stats.mistakes++;
        elements.phoneInput.className = 'phone-input incorrect';
        elements.incorrectSound.play();
      }
      elements.accuracy.textContent = Math.round((stats.correct / stats.attempts) * 100) + '%';
    }

    document.addEventListener('keydown', e => {
      if (e.code === 'Space') { e.preventDefault(); generate(); }
      if (e.key === 'Alt') { 
        e.preventDefault(); 
        if (!isCurrentNumberSolved) {
           elements.phoneInput.value = ''; 
           elements.phoneInput.className = 'phone-input'; 
           playNumber(); 
        }
      }
      if (e.key === 'Enter') { e.preventDefault(); checkAnswer(); }
    });
  </script>
</body>
</html>
